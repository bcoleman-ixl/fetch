<!DOCTYPE html>
<!-- TODO: Still need to update and add features for sorting templates -->
<html>

<head>
  <meta charset='utf-8'>
  <link rel='stylesheet' href='/styles.css'>
  <link href="/fa/css/fontawesome-all.css" rel="stylesheet">

  <!-- Bootstrap minified CSS -->
  <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css'>
  <!-- Google Fonts -->
  <link href='https://fonts.googleapis.com/css?family=Open+Sans|Roboto|Black+Han+Sans' rel='stylesheet'>
  <title>Jibu - Admin Console</title>
</head>

<body>
  <div class='signIn'>

  </div>
  <!-- Manage templates modal -->
  <div class='modal fade' id='manageTemplates' tabindex='-1' role='dialog' aria-labelledby='Manage templates' aria-hidden='true'>
    <div class='modal-dialog' role='document'>
      <div class='modal-content'>
        <div class='modal-header'>
          <span id='manageTemplatesTitle'>Add new template</span>
          <button type='button' class='close' data-dismiss='modal' aria-label='Close'>
          <span aria-hidden='true'>&times;</span>
        </button>
        </div>
        <div class='new-template'>
          <form id='templatesForm' action='/add' method='POST' autocomplete='off' id='templatesForm'>
            <div class='row'>

              <div class='col-lg-12'>
                <div class='form-group' style='padding-right: 0px;'>
                  <input type='text' class='form-control' id='name' name='name' required='true' placeholder='Template Name' maxlength='39'>
                </div>
              </div>
            </div>
            <div class='form-group'>
              <textarea rows='0' cols='80' id='body' name='body'></textarea>
            </div>
            <div class='row'>
              <div class='form-group col-lg-6 col-md-6'>
                <select class='form-control' id='category' name='category' required='true'>
                  <option disabled selected value> --Select category-- </option>
                  <option>Analytics</option>
                  <option>Audio</option>
                  <option>Diagnostic</option>
                  <option>Network</option>
                  <option>Roster</option>
                  <option>Skills</option>
                  <option>Signing_In</option>
                  <option>SmartScore</option>
                  <option>Other</option>
                </select>
              </div>
              <div class='form-group col-lg-6 col-md-6'>
                <select class='form-control' id='program' name='program' required='true'>
                  <option disabled selected value> --Select program-- </option>
                  <option>IXL</option>
                  <option>QW</option>
                  <option>QB</option>
                </select>
              </div>


              <div class='form-group'>
                <input type='hidden' class='form-control' id='id' name='id' required='true'>
                <input type='hidden' id='updatedDate' name='updatedDate' value='error'>
                <input type='hidden' id='addedByUser' name='addedByUser' value='<%= user.email %>'>
                <input type='hidden' id='ranking' name='ranking' value=0>
                <input type='hidden' id='copyFull' name='copyFull' value=0>
                <input type='hidden' id='copyPortion' name='copyPortion' value=0>
                <input type='hidden' id='team' name='team' value='<%= user.team %>'>
                <input type='hidden' id='greeting' name='greeting' value='default'>
                <input type='hidden' id='closing' name='closing' value='default'>
              </div>
            </div>
            <div class="row">
              <div class="form-group col-lg-6 col-md-6">
                <select class='form-control' id='publicStatus' name='publicStatus' required='true'>
                  <option disabled selected value> --Select public status-- </option>
                  <option>true</option>
                  <option>false</option>
                </select>
              </div>

              <div class='form-group col-lg-6 col-md-6'>
                <input type='text' class='form-control' id='replyEmail' name='replyEmail' required='true' placeholder='Reply E-mail'>
              </div>
            </div>
            <div class='form-group'>
              <input type='text' class='form-control' id='tags' name='tags' required='true' placeholder='Tags' maxlength='39'>
            </div>

            <button type='submit' class='btn btn-primary' id='submitBtn'>Submit</button>
          </form>
        </div>
      </div>
    </div>
  </div>
  <!-- End manage templates modal -->

  <!-- Confirm remove modal -->
  <div class='modal fade' id='confirmRemoveDialog' tabindex='-1' role='dialog' aria-labelledby='myModalLabel' aria-hidden='true'>
    <div class='modal-dialog'>
      <div class='modal-content'>
        <div class='modal-header'>
          <h4>Are you sure you want to remove: <br>
            <b><span id='confirmRemoveName'>*error*</span></b>?
          </h4>
        </div>
        <div class='modal-footer' id='confirmRemoveModal'>
          <button type='button' class='btn btn-default' data-dismiss='modal'>Cancel</button>
          <a class='btn btn-danger btn-ok' id='confirmRemoveBtn' onclick='remove(event)'>Delete</a>
        </div>
      </div>
    </div>
  </div>
  <!-- End modal -->

  <!-- Navbar -->
  <nav class='navbar navbar-default'>
    <div class="nav navbar-nav">

      <li class="dropdown">
        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
          <img class="profile-img" src="<%= user.img %>" alt=""></a>
        <ul class="dropdown-menu">
          <li>
            <!-- Shows Hello and users name if user is signed in -->
            <% if (user) { %>
              <li id='greeting'>Hello
                <span id="userFirstName"><%= user.name %></span>!
                <h5 id="userEmail"><%= user.email %></h5>
              </li>
              <% } %>
          </li>
          <li class="divider"></li>
          <li><a id='' href='#manageTemplates' data-toggle='modal' data-target='#manageTemplates' onclick='setTemplateId()'> Add a template</a></li>
          <!-- If user is admin, admin console option is shown -->
          <% if (user.type == 'admin') { %>
            <li><a href="/templates">User Console</a></li>
            <li><a href="/admin/logs">Search logs</a></li>
            <% } %>
              <li class="divider"></li>
              <li id="logout"> <button class="btn btn-danger btn-sm" type="button" name="button" onclick="location.href = '/logout';">Logout</button></li>
        </ul>
      </li>
    </div>
  </nav>
  <!-- End navbar -->


  <!-- Header -->
  <div class="header">
    <div class="row space">
      <div class="col-lg-5">
      </div>
      <div class="col-lg-2">
        <h1 id="title">Jibu</h1>
      </div>
      <div class="col-lg-5">
      </div>
    </div>
    <h4 id="subtitle">Your responses, organized.</h4>
    <h6 id="description">(Jibu is a Swahili word meaning response or answer)</h6>
  </div>
  <!-- End header -->

  <!-- Search bar -->
  <div class='row space'>
    <div class='col-lg-4 col-md-4'></div>
    <div class='col-lg-4 col-md-4'>
      <div class='form-group has-feedback has-clear'>
        <input type='text' class='form-control input-lg' id='search-bar' autofocus="autofocus" placeholder='Search' onkeyup='search()' spellcheck='false'>
        <span id="clear-search" class="glyphicon glyphicon-remove-circle"></span>
      </div>
    </div>
    <div class='col-lg-4 col-md-4'></div>
  </div>
  <!-- End search bar -->


  <!-- Templates -->
  <div class='row space'>
    <div class='col-lg-1 col-md-1'>
    </div>
    <div class='col-lg-12 col-md-12'>
      <h2><i class="fas fa-wrench"></i> Under construction. Template count: <%= templatesArr.length %></h2>
      <ul id='data-table' class='align'>


        <% function compare(a,b) {  if (a.ranking < b.ranking){ return -1; }%>
          <% if (a.ranking > b.ranking){ return 1; } %>
            <% return 0; }%>

              <% templates = []; %>

                <% templatesArr.sort(compare); %>
                  <% for (var i = 0; i < templatesArr.length; i++) { templates.unshift(templatesArr[i]); } %>


                    <!-- Loop through all templates -->
                    <% for(var i = 0; i < templates.length; i++) { %>
                      <% console.log( i + '.' + templatesArr[i].ranking + ' Name: ' + templatesArr[i].name); %>



                        <!-- NOTE: Remove value of reply e-mail Change to || and make != == -->
                        <% if ((templates[i].publicStatus == 'true' || templates[i].addedByUser == 'salesforce@salesforce.com')) { %>


                          <li id='<%= templates[i].id %>' class='template admin'>
                            <!-- Name of the template, check mark shown if id is 'Template-Verified' -->
                            <h2 class='<%= templates[i].category.toLowerCase() %>' id='templateName'>
                <%= templates[i].name %>
                <% if(templates[i].addedByUser == 'salesforce@salesforce.com'){ %>
                  <i class='fas fa-check' id='verified'></i>
                  <% } else { %>

                    <i class="fas fa-exclamation-triangle" id="notVerified"></i>

                  <% } %>
            </h2>
                            <div class='details'>
                              <!-- Ranking number (hidden), Template ID, and template last updated date -->
                              <h3 class='line'>
                  <span id='templateRanking' hidden>
                    <%= templates[i].ranking %>
                  </span>
                  <span id='templateCopyFull' hidden>
                    <%= templates[i].copyFull %>
                  </span>
                  <span id='templateCopyPortion' hidden>
                    <%= templates[i].copyPortion %>
                  </span>
                  <span id='templateUpdatedDate'>
                    <%= templates[i].updatedDate %>
                  </span>
                  |
                  <span>
                    <span id='templateProgram'><%= templates[i].program.toUpperCase() %></span>
                    <!-- Template category -->
                    |
                    <span class='<%= templates[i].category.toLowerCase() %>' id='templateCategory'> <%= templates[i].category %></span>
                                  </span>
                                <!-- Buttons -->
                                <!-- If public is false (meaning this template is for private use) then show these buttons which allows the user to edit, and remove the template -->


                                <!-- If template was added by user, show edit button -->
                                <div class='line' id='edit'>
                                  <button id='editBtn' class='btn line'><i class='fas fa-pencil-alt fa-lg'></i></button>
                                </div>
                                <!-- Clear the rank of this template (will add back in later if needed)
              -->
                                <div class='line' id='clearRank'>
                                  <button id='clearRankBtn' class='btn line'><i class='fas fa-ban fa-lg'></i></button>
                                </div>
                                <!-- If user is admin OR this template was added by current user, show remove button -->
                                <div class='line' id='removeConfirm'>
                                  <button id='removeConfirmBtn' class='btn line'><i class='far fa-trash-alt fa-lg' ></i></button>
                                </div>

                              </div>

                              <div class='details'>
                                <!-- Ranking number (hidden), Template ID, and template last updated date -->
                                <h3 class='line'>
                  Total:
                  <span id='templateRanking'>

                    <%= templates[i].ranking %>
                  </span>
                  Full:
                  <span id='templateCopyFull'>
                   <%= templates[i].copyFull %>
                  </span>
                    Portion:
                  <span id='templateCopyPortion'>
            <%= templates[i].copyPortion %>
                  </span>
                <h3 id='templateUpdatedDate'>
                   <%= templates[i].id %>
                  </h3>

                              </h3>
                              <!-- Buttons -->
                              <!-- Copy template, greeting, closing, and signature -->
                            </div>

                            <div class='<%= templates[i].category.toLowerCase() %> templateBodyAdmin' id='templateBody'>
                              <%- templates[i].body %>
                            </div>
                            <div class='row'>
                              <div class='col-lg-12 col-md-12'>
                                <!-- Template tags and template type (hidden) -->
                                <h3 class='tags' id='templateTags'><%= templates[i].tags %></h3>
                              </div>


                            </div>
                            <div class='row'>
                              <div class='col-lg-12 col-md-12'>

                                <h3 id='addedByUser'>
                    Added by: <%= templates[i].addedByUser %>
                  </h3>
                                <h3 class='type' id='templateFolder'>Folder: <%= templates[i].folder %></h3>
                                <h3 class='type' id='templateTeam'><%= templates[i].team %></h3>
                                <h3 class='type' id='templateReplyEmail'><%= templates[i].replyEmail %></h3>
                                <h3 class='type' id='templatePublicStatus' hidden><%= templates[i].publicStatus %></h3>
                                <h3 class='type' id='templateGreeting' hidden><%= templates[i].greeting %></h3>
                                <h3 class='type' id='templateClosing' hidden><%= templates[i].closing %></h3>

                              </div>


                            </div>
                          </li>

                          <% } else {%>
                            <% } %>

                              <% } %>
                                <!-- End For loop -->

      </ul>

    </div>
    <div class='col-lg-1'></div>
  </div>
  <!-- End templates -->

  <!-- Logout -->

  <!-- End Logout -->


</body>

<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
<script src='https://cloud.tinymce.com/stable/tinymce.min.js?apiKey=q4w1ytxm4ft7tl8tg92mbys2kh30beuux061ovviw4oc4pqo'></script>
<script src='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js'></script>
<script src='app-main.js'></script>
<script src='search.js'></script>

</html>