<% function compare(a,b) {  if (a.ranking < b.ranking){ return -1; } if (a.ranking > b.ranking){ return 1; } return 0; }%>
  <% templatesArr.sort(compare); %>
    <% templates = templatesArr; %>
      <% var errorCount = 0; %>
        <% var templateCount = 0; %>
          <% for(var i = templates.length - 1; i > 0; i--) { %>
            <% if(user.team == 'accountServices' && templates[i].program != 'AS'){ continue; } %>
              <% try {
        var errorStatus = 'noError';
        var errorMessage = '';
        var category = templates[i].category.substr(0, 5).toLowerCase();
        var program = templates[i].program.toUpperCase();
        if(templates[i].name == '' || templates[i].name == null){
          throw 'Template name is blank or null';
        } else if (templates[i].category == ""){
          throw 'Category is blank or null'
        }
       } catch (e) {
      errorStatus = 'error';
      errorMessage = e
       %>
                <% } %>
                  <%  if(errorStatus != 'error') { %>
                    <li id='<%= templates[i].id %>' class='template user <%= errorStatus %>' style="display:none;">
                      <div class="row">
                        <div class="col-lg-11 col-md-11 col-sm-11 nameCol">
                          <h2 id='templateName'>
                    <%= templates[i].name %></h2>
                        </div>
                        <div class="col-lg-1 col-md-1 col-sm-1 verifiedCol">
                          <% if(templates[i].addedByUser == 'salesforce@salesforce.com'){ %>
                            <svg class="overflow" viewBox="0 0 448 512" data-fa-i2svg=""><path id="verified" d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"></path></svg>
                            <% } else if (templates[i].addedByUser == user.email && templates[i].publicStatus == 'false'){ %>
                              <svg viewBox="0 0 448 512">
                <path id="notVerifiedUser" d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48z"></path>
              </svg>
                              <% }  else {%>
                                <svg class="overflow" viewBox="0 0 448 512" data-fa-i2svg=""><path id="notVerified" d="M569.517 440.013C587.975 472.007 564.806 512 527.94 512H48.054c-36.937 0-59.999-40.055-41.577-71.987L246.423 23.985c18.467-32.009 64.72-31.951 83.154 0l239.94 416.028zM288 354c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"></path></svg>
                                <% } %>
                        </div>
                      </div>
                      <div class="details">
                        <span id='templateRanking' hidden>
<%= templates[i].ranking %>
</span>
                        <span id='templateCopyFull' hidden>
<%= templates[i].copyFull %>
</span>
                        <span id='templateCopyPortion' hidden>
<%= templates[i].copyPortion %>
</span>
                        <span id='templateUpdatedDate'>
         <%= templates[i].updatedDate %>
       </span> @<span id='templateProgram'><%= program %></span>



                        <% if(templates[i].versions != null ) {
                            var isEmpty = true;
                            for(r = 0; r < templates[i].versions.length; r++) {
                            if(templates[i].versions[r][1] != '') {
                            var isEmpty = false;
                            break;
                            }
                            }
                            %>
                          <% if(!isEmpty) { %>

                            <div id="versions">
                              <button class="buttonStyle" type="button" name="button" id="versionsBtn">
                            <svg  viewBox="0 0 512 512">
                            <path d="M296 32h192c13.255 0 24 10.745 24 24v160c0 13.255-10.745 24-24 24H296c-13.255 0-24-10.745-24-24V56c0-13.255 10.745-24 24-24zm-80 0H24C10.745 32 0 42.745 0 56v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24zM0 296v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H24c-13.255 0-24 10.745-24 24zm296 184h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H296c-13.255 0-24 10.745-24 24v160c0 13.255 10.745 24 24 24z"></path>
                            </svg>
                            </button>
                            </div>
                            <% } %>
                              <% } %>
                                <% if (templates[i].publicStatus == 'false' || user.type == 'admin' || templates[i].addedByUser == user.email) { %>

                                  <% if (templates[i].addedByUser == user.email || user.type == 'admin') { %>
                                    <div id="edit">
                                      <button class="buttonStyle" type="button" name="button" id="editBtn">
                <svg viewBox="0 0 512 512">
                  <path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z"></path>
                </svg>
              </button>
                                    </div>
                                    <% } %>


                                      <% if (templates[i].addedByUser == user.email || user.type == 'admin') { %>
                                        <div id="removeConfirm">
                                          <button class="buttonStyle" type="button" name="button" id="removeConfirmBtn">
                          <svg viewBox="0 0 448 512">
                          <path d="M192 188v216c0 6.627-5.373 12-12 12h-24c-6.627 0-12-5.373-12-12V188c0-6.627 5.373-12 12-12h24c6.627 0 12 5.373 12 12zm100-12h-24c-6.627 0-12 5.373-12 12v216c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12V188c0-6.627-5.373-12-12-12zm132-96c13.255 0 24 10.745 24 24v12c0 6.627-5.373 12-12 12h-20v336c0 26.51-21.49 48-48 48H80c-26.51 0-48-21.49-48-48V128H12c-6.627 0-12-5.373-12-12v-12c0-13.255 10.745-24 24-24h74.411l34.018-56.696A48 48 0 0 1 173.589 0h100.823a48 48 0 0 1 41.16 23.304L349.589 80H424zm-269.611 0h139.223L276.16 50.913A6 6 0 0 0 271.015 48h-94.028a6 6 0 0 0-5.145 2.913L154.389 80zM368 128H80v330a6 6 0 0 0 6 6h276a6 6 0 0 0 6-6V128z"></path>
                          </svg>
                          </button>
                                        </div>
                                        <% } %>
                                          <% } %>
                                            <span id="copiedAlert" hidden>Copied</span>
                      </div>

                      <div class="row">
                        <div class="col-lg-12 col-md-12 col-sm-12">

                          <% if(errorStatus == 'error') { %>
                            <div class='<%= templates[i].category %> templateBodyUser' ondragover="allowDrop(event)" id="templateBodyError">
                              <br> Error message:
                              <%= errorMessage %>
                                <br> Template Id:
                                <%= templates[i].id %>
                                  <br> Template Name:
                                  <%= templates[i].name %>
                                    <br> Template Category:
                                    <%= templates[i].category %>
                                      <br> Template Program:
                                      <%= templates[i].program %>
                                        <div class='<%= templates[i].category %> templateBodyUser' ondragover="allowDrop(event)" id='templateBody' hidden>
                                          <%- templates[i].body %>
                                        </div>
                            </div>
                            <% } else { %>
                              <div class='<%= templates[i].category %> templateBodyUser' ondragover="allowDrop(event)" id='templateBody'>
                                <%- templates[i].body %>
                              </div>
                              <% if(templates[i].versions != null) { %>
                                <%
                                  var empty = true;
                                  for(r = 0; r < templates[i].versions.length; r++) {
                                    if(templates[i].versions[r][1] != '') {
                                      var empty = false;
                                      break;
                                    }
                                  }
                                  %>
                                  <% if(!empty) { %>
                                    <div class="versions">
                                      <% for(k = 0; k < templates[i].versions.length; k++) { %>
                                        <div class="<%= 'version' + k %>">
                                          <div class="versionDescription" id="<%= 'versionDescription' + k %>">
                                            <%= templates[i].versions[k][0];%>
                                          </div>
                                          <div id="<%= 'versionBody' + k %>" hidden>
                                            <%- templates[i].versions[k][1];%>
                                          </div>
                                        </div>
                                        <% } %>
                                    </div>
                                    <% } %>
                                      <% } %>
                                        <% } %>
                        </div>
                      </div>
                      <div class='row'>
                        <div class='col-lg-7 col-md-7'>
                          <h3 class='tags' id="templateTags"><%= templates[i].tags %></h3>
                          <h3 class='type' id='templateTeam' hidden><%= templates[i].team %></h3>
                          <h3 class='type' id='templateTeam' hidden>@<%=templates[i].addedByUser %></h3>
                          <h3 class='type' id='templatePublicStatus' hidden><%= templates[i].publicStatus %></h3>
                          <h3 class='type' id='templateReplyEmail' hidden><%= templates[i].replyEmail %></h3>
                          <h3 class='type' id='templateGreeting' hidden><%= templates[i].greeting %></h3>
                          <h3 class='type' id='templateClosing' hidden><%= templates[i].closing %></h3>
                          <h3 class='type' id='templateFolder' hidden><%= templates[i].folder %></h3>
                        </div>
                        <div class='col-lg-5 col-md-5 alignRight'>
                          <h3 class='category' id="templateCategory"><span class="<%= category %>"> <%= templates[i].category %> </span></h3>
                        </div>
                      </div>

                    </li>
                    <% } else { %>
                        <% errorCount = errorCount + 1;  %>
                          <% }  %>
                            <% } %>
                              <div class='row'>
                                <div class='col-lg-7 col-md-7'>
                                  <h3 class='tags' id="totalErrorCount" hidden><%= errorCount %></h3>
                                </div>

                              </div>
