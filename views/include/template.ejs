<% var templateCount = 0; %>
<% for(var i = templatesArr.length - 1; i >= 0; i--) { %>
<% var category = templatesArr[i].category.substr(0, 5).toLowerCase(); %>
<% var program = templatesArr[i].program.toUpperCase(); %>
<% templateCount = templateCount + 1; %>
<% if(templateCount < countLimit) { %>
<li id='<%= templatesArr[i].id %>' class='template user '>
  <% } else { %>
<li id='<%= templatesArr[i].id %>' class='template user' style="display:none">
  <% } %>
  <div class="templateNameSection">
    <h2 class="templateName" id='templateName'>
      <%= templatesArr[i].name %>
    </h2>
    <div class="vettedCol">
      <span class="tooltiptext">
        Id:
        <%= templatesArr[i].id %>
        <br>
        Last updated:
        <%= templatesArr[i].updatedDate %>
        <br> Clicks:
        <%= templatesArr[i].ranking %>
        <br> Added by user:
        <%= templatesArr[i].addedByUser %>
        <br> Last updated by user:
        <%= templatesArr[i].lastUpdatedByUser %>
        <br> Public status:
        <%= templatesArr[i].publicStatus %>
        <br> Folder:
        <%= templatesArr[i].folder %>
      </span>
      <% if(templatesArr[i].vetted == 'Yes'){ %>
      <svg class="searchByClick searchByClickHover vetted" viewBox="0 0 512 512" id="vetted">
        <path d="M504 256c0 136.967-111.033 248-248 248S8 392.967 8 256 119.033 8 256 8s248 111.033 248 248zM227.314 387.314l184-184c6.248-6.248 6.248-16.379 0-22.627l-22.627-22.627c-6.248-6.249-16.379-6.249-22.628 0L216 308.118l-70.059-70.059c-6.248-6.248-16.379-6.248-22.628 0l-22.627 22.627c-6.248 6.248-6.248 16.379 0 22.627l104 104c6.249 6.249 16.379 6.249 22.628.001z"></path>
      </svg>
      <% } else if ((templatesArr[i].addedByUser == user.email && templatesArr[i].publicStatus == 'false') || (route == 'personalTemplates')){ %>
      <svg class="searchByClick searchByClickHover notVettedUser" viewBox="0 0 512 512" id="notVettedUser">
        <path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"></path>
      </svg>
      <% } else { %>
      <svg class="searchByClick searchByClickHover notVetted" viewBox="0 0 512 512" id="notVetted">
        <path d="M504 256c0 136.997-111.043 248-248 248S8 392.997 8 256C8 119.083 119.043 8 256 8s248 111.083 248 248zm-248 50c-25.405 0-46 20.595-46 46s20.595 46 46 46 46-20.595 46-46-20.595-46-46-46zm-43.673-165.346l7.418 136c.347 6.364 5.609 11.346 11.982 11.346h48.546c6.373 0 11.635-4.982 11.982-11.346l7.418-136c.375-6.874-5.098-12.654-11.982-12.654h-63.383c-6.884 0-12.356 5.78-11.981 12.654z"></path>
      </svg>
      <% } %>
    </div>
  </div>
  <div class="templateButtonsSection">
    <div class="details">
      <span id='templateRanking' hidden>
        <%= templatesArr[i].ranking %></span>
      <span id='templateCopyFull' hidden>
        <%= templatesArr[i].copyFull %></span>
      <span id='templateCopyPortion' hidden>
        <%= templatesArr[i].copyPortion %>
      </span>
      <span id='templateId' hidden>
        <%= templatesArr[i].id %>
      </span>
      <span class="searchByClick" id='templateProgram'>
        <%= program.toString().trim() + ' '%></span>
      <div id="copyPortion">
        <button class="buttonStyle" type="button" name="button" id="copyPortionBtn">
          <svg viewBox="0 0 576 512">
            <path d="M569.354 231.631C512.969 135.949 407.81 72 288 72 168.14 72 63.004 135.994 6.646 231.631a47.999 47.999 0 0 0 0 48.739C63.031 376.051 168.19 440 288 440c119.86 0 224.996-63.994 281.354-159.631a47.997 47.997 0 0 0 0-48.738zM288 392c-75.162 0-136-60.827-136-136 0-75.162 60.826-136 136-136 75.162 0 136 60.826 136 136 0 75.162-60.826 136-136 136zm104-136c0 57.438-46.562 104-104 104s-104-46.562-104-104c0-17.708 4.431-34.379 12.236-48.973l-.001.032c0 23.651 19.173 42.823 42.824 42.823s42.824-19.173 42.824-42.823c0-23.651-19.173-42.824-42.824-42.824l-.032.001C253.621 156.431 270.292 152 288 152c57.438 0 104 46.562 104 104z">
            </path>
          </svg>
        </button>
      </div>
      <div id="snippets">
        <button class="buttonStyle" type="button" name="button" id="snippetsBtn">
          <svg viewBox="0 0 576 512">
            <path d="M288 12.3V240h227.7c6.9 0 12.3-5.8 12-12.7-6.4-122.4-104.5-220.6-227-227-6.9-.3-12.7 5.1-12.7 12zM552.7 288c6.9 0 12.3 5.8 12 12.7-2.8 53.2-23.2 105.6-61.2 147.8-4.6 5.1-12.6 5.4-17.5.5L325 288h227.7zM401 433c4.8 4.8 4.7 12.8-.4 17.3-42.6 38.4-99 61.7-160.8 61.7C107.6 511.9-.2 403.8 0 271.5.2 143.4 100.8 38.9 227.3 32.3c6.9-.4 12.7 5.1 12.7 12V272l161 161z"></path>
          </svg>
        </button>
      </div>
      <div id="reply">
        <button class="buttonStyle" type="button" name="button" id="replyBtn">
          <svg viewBox="0 0 512 512">
            <path d="M8.309 189.836L184.313 37.851C199.719 24.546 224 35.347 224 56.015v80.053c160.629 1.839 288 34.032 288 186.258 0 61.441-39.581 122.309-83.333 154.132-13.653 9.931-33.111-2.533-28.077-18.631 45.344-145.012-21.507-183.51-176.59-185.742V360c0 20.7-24.3 31.453-39.687 18.164l-176.004-152c-11.071-9.562-11.086-26.753 0-36.328z"></path>
          </svg>
        </button>
      </div>
      <% if(user.team == "teacherMemberships" &&  templatesArr[i].quote) { %>
      <div id="quote">
        <button class="buttonStyle" type="button" name="button" id="quoteBtn">
          <svg viewBox="0 0 512 512">
            <path d="M464 256h-80v-64c0-35.3 28.7-64 64-64h8c13.3 0 24-10.7 24-24V56c0-13.3-10.7-24-24-24h-8c-88.4 0-160 71.6-160 160v240c0 26.5 21.5 48 48 48h128c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48zm-288 0H96v-64c0-35.3 28.7-64 64-64h8c13.3 0 24-10.7 24-24V56c0-13.3-10.7-24-24-24h-8C71.6 32 0 103.6 0 192v240c0 26.5 21.5 48 48 48h128c26.5 0 48-21.5 48-48V304c0-26.5-21.5-48-48-48z"></path>
          </svg>
        </button>
      </div>
      <%} %>
      <% if(templatesArr[i].versions != null ) {
        var isEmpty = true;
        for(r = 1; r < templatesArr[i].versions.length; r++) {
          if(templatesArr[i].versions[r][1] != '') {
            var isEmpty = false;
            break;
          }
        } %>
      <% if(!isEmpty) { %>
      <div id="versions">
        <button class="buttonStyle" type="button" name="button" id="versionsBtn">
          <svg viewBox="0 0 512 512">
            <path d="M296 32h192c13.255 0 24 10.745 24 24v160c0 13.255-10.745 24-24 24H296c-13.255 0-24-10.745-24-24V56c0-13.255 10.745-24 24-24zm-80 0H24C10.745 32 0 42.745 0 56v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24zM0 296v160c0 13.255 10.745 24 24 24h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H24c-13.255 0-24 10.745-24 24zm296 184h192c13.255 0 24-10.745 24-24V296c0-13.255-10.745-24-24-24H296c-13.255 0-24 10.745-24 24v160c0 13.255 10.745 24 24 24z">
            </path>
          </svg>
        </button>
      </div>
      <% } %>
      <% } %>
      <% if (templatesArr[i].addedByUser != user.email || templatesArr[i].publicStatus != 'false') { %>
      <div id="share">
        <button class="buttonStyle" type="button" name="button" id="shareBtn">
          <svg viewBox="0 0 512 512">
            <path d="M326.612 185.391c59.747 59.809 58.927 155.698.36 214.59-.11.12-.24.25-.36.37l-67.2 67.2c-59.27 59.27-155.699 59.262-214.96 0-59.27-59.26-59.27-155.7 0-214.96l37.106-37.106c9.84-9.84 26.786-3.3 27.294 10.606.648 17.722 3.826 35.527 9.69 52.721 1.986 5.822.567 12.262-3.783 16.612l-13.087 13.087c-28.026 28.026-28.905 73.66-1.155 101.96 28.024 28.579 74.086 28.749 102.325.51l67.2-67.19c28.191-28.191 28.073-73.757 0-101.83-3.701-3.694-7.429-6.564-10.341-8.569a16.037 16.037 0 0 1-6.947-12.606c-.396-10.567 3.348-21.456 11.698-29.806l21.054-21.055c5.521-5.521 14.182-6.199 20.584-1.731a152.482 152.482 0 0 1 20.522 17.197zM467.547 44.449c-59.261-59.262-155.69-59.27-214.96 0l-67.2 67.2c-.12.12-.25.25-.36.37-58.566 58.892-59.387 154.781.36 214.59a152.454 152.454 0 0 0 20.521 17.196c6.402 4.468 15.064 3.789 20.584-1.731l21.054-21.055c8.35-8.35 12.094-19.239 11.698-29.806a16.037 16.037 0 0 0-6.947-12.606c-2.912-2.005-6.64-4.875-10.341-8.569-28.073-28.073-28.191-73.639 0-101.83l67.2-67.19c28.239-28.239 74.3-28.069 102.325.51 27.75 28.3 26.872 73.934-1.155 101.96l-13.087 13.087c-4.35 4.35-5.769 10.79-3.783 16.612 5.864 17.194 9.042 34.999 9.69 52.721.509 13.906 17.454 20.446 27.294 10.606l37.106-37.106c59.271-59.259 59.271-155.699.001-214.959z">
            </path>
          </svg>
        </button>
      </div>
      <% } %>
      <% if (templatesArr[i].publicStatus == 'false' || user.type == 'admin' || templatesArr[i].addedByUser == user.email) { %>
      <% if ((user.type == 'admin' && templatesArr[i].vetted == 'Yes' && user.vettingRights) || (templatesArr[i].vetted == 'No' && templatesArr[i].addedByUser == user.email) || (user.type == 'admin' && templatesArr[i].vetted == 'No')) { %>
      <div id="edit">
        <button class="buttonStyle" type="button" name="button" id="editBtn">
          <svg viewBox="0 0 512 512">
            <path d="M497.9 142.1l-46.1 46.1c-4.7 4.7-12.3 4.7-17 0l-111-111c-4.7-4.7-4.7-12.3 0-17l46.1-46.1c18.7-18.7 49.1-18.7 67.9 0l60.1 60.1c18.8 18.7 18.8 49.1 0 67.9zM284.2 99.8L21.6 362.4.4 483.9c-2.9 16.4 11.4 30.6 27.8 27.8l121.5-21.3 262.6-262.6c4.7-4.7 4.7-12.3 0-17l-111-111c-4.8-4.7-12.4-4.7-17.1 0zM124.1 339.9c-5.5-5.5-5.5-14.3 0-19.8l154-154c5.5-5.5 14.3-5.5 19.8 0s5.5 14.3 0 19.8l-154 154c-5.5 5.5-14.3 5.5-19.8 0zM88 424h48v36.3l-64.5 11.3-31.1-31.1L51.7 376H88v48z">
            </path>
          </svg>
        </button>
      </div>
      <% } %>
      <% if (templatesArr[i].addedByUser == user.email || user.type == 'admin') { %>
      <div id="removeConfirm">
        <button class="buttonStyle" type="button" name="button" id="removeConfirmBtn">
          <svg viewBox="0 0 448 512">
            <path d="M192 188v216c0 6.627-5.373 12-12 12h-24c-6.627 0-12-5.373-12-12V188c0-6.627 5.373-12 12-12h24c6.627 0 12 5.373 12 12zm100-12h-24c-6.627 0-12 5.373-12 12v216c0 6.627 5.373 12 12 12h24c6.627 0 12-5.373 12-12V188c0-6.627-5.373-12-12-12zm132-96c13.255 0 24 10.745 24 24v12c0 6.627-5.373 12-12 12h-20v336c0 26.51-21.49 48-48 48H80c-26.51 0-48-21.49-48-48V128H12c-6.627 0-12-5.373-12-12v-12c0-13.255 10.745-24 24-24h74.411l34.018-56.696A48 48 0 0 1 173.589 0h100.823a48 48 0 0 1 41.16 23.304L349.589 80H424zm-269.611 0h139.223L276.16 50.913A6 6 0 0 0 271.015 48h-94.028a6 6 0 0 0-5.145 2.913L154.389 80zM368 128H80v330a6 6 0 0 0 6 6h276a6 6 0 0 0 6-6V128z">
            </path>
          </svg>
        </button>
      </div>
      <% } %>
      <% } %>
      <div class="templateInfo" id="info">
        <button class="buttonStyle" type="button" name="button" id="infoBtn">
          <svg viewBox="0 0 512 512">
            <path d="M256 8C119.043 8 8 119.083 8 256c0 136.997 111.043 248 248 248s248-111.003 248-248C504 119.083 392.957 8 256 8zm0 110c23.196 0 42 18.804 42 42s-18.804 42-42 42-42-18.804-42-42 18.804-42 42-42zm56 254c0 6.627-5.373 12-12 12h-88c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h12v-64h-12c-6.627 0-12-5.373-12-12v-24c0-6.627 5.373-12 12-12h64c6.627 0 12 5.373 12 12v100h12c6.627 0 12 5.373 12 12v24z"></path>
          </svg>
        </button>
      </div>
    </div>
  </div>
  <div class="templateBodySection">
    <div class="accountTypes" id="accountTypes">
    </div>
    <div class="countries" id="countries">
    </div>
    <div class="subjects" id="subjects">
    </div>
    <div class="licenses" id="licenses">
    </div>
    <div class='<%= templatesArr[i].category %> templateBodyUser' ondragover="allowDrop(event)" id='templateBody'>
      <%- templatesArr[i].versions[0][1]; %>
    </div>
    <% if(templatesArr[i].versions[1] != null) { %>
    <% var empty = true;
      for(r = 1; r < templatesArr[i].versions.length; r++) {
        if(templatesArr[i].versions[r][1] != '') {
          var empty = false;
          break;
        }
      } %>
    <% if(!empty) { %>
    <div class="versions">
      <% for(k = 1; k < 5; k++) { %>
      <div class="<%= 'version' + k %>">
        <div class="versionDescription" id="<%= 'versionDescription' + k %>">
          <%= templatesArr[i].versions[k][0];%>
        </div>
        <div id="<%= 'versionBody' + k %>" hidden>
          <%- templatesArr[i].versions[k][1];%>
        </div>
      </div>
      <% } %>
    </div>
    <% } %>
    <% } %>
  </div>
  <div class='templateFooterSection'>
    <span class='tags' id="templateTags">
      <%= templatesArr[i].tags %>
    </span>
    <span class='category'><span class="<%= category %> categorySpan categoryFallback searchByClick searchByClickHover" id="templateCategory">
        <%= templatesArr[i].category %></span>
    </span>
    <h3 class='type' id='templateTeam' hidden>
      <%= templatesArr[i].team %>
    </h3>
    <h3 class='type' id='templateProgramWithHash' hidden>
      <%= '#' + templatesArr[i].program %>
    </h3>
    <h3 class='type' id='templateAddedByUser' hidden>
      <%= templatesArr[i].addedByUser %>
    </h3>
    <h3 class='type' id='templatePublicStatus' hidden>
      <%= templatesArr[i].publicStatus %>
    </h3>
    <h3 class='type' id='templateReplyEmail' hidden>
      <%= templatesArr[i].replyEmail %>
    </h3>
    <h3 class='type' id='templateGreeting' hidden>
      <%= templatesArr[i].greeting %>
    </h3>
    <h3 class='type' id='templateClosing' hidden>
      <%= templatesArr[i].closing %>
    </h3>
    <h3 class='type' id='templateFolder' hidden>
      <%= templatesArr[i].folder %>
    </h3>
    <h3 class='type' id='templateVetted' hidden>
      <%= templatesArr[i].vetted %>
    </h3>
    <span hidden id="programHashtagSearch">
      <%= "#program=" + templatesArr[i].program %> </span>
    <span hidden id="addedByUserHashtagSearch">
      <%= "#user=" +    templatesArr[i].addedByUser %> </span>
    <span hidden id="publicStatusHashtagSearch">
      <%= "#publicStatus=" +  templatesArr[i].publicStatus %> </span>
    <span hidden id="vettedHashtagSearch">
      <%= "#vetted=" +  templatesArr[i].vetted %> </span>
    <span hidden id="categoryHashtagSearch">
      <%= "#category=" + templatesArr[i].category %> </span>
  </div>
</li>
<% } %>
